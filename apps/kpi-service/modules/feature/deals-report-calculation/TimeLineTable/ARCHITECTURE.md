# Архитектура TimeLineTable Module

## Обзор

Модуль `TimeLineTable` представляет собой рефакторенную версию компонента таймлайна сделок с правильной архитектурой, разделенной на features, widgets, модели и утилиты.

## Структура модуля

```
TimeLineTable/
├── model/
│   ├── types/
│   │   └── index.ts              # TypeScript типы и интерфейсы
│   └── slice/
│       └── timelineSlice.ts      # Redux slice для состояния
├── lib/
│   └── utils/
│       ├── timeline.utils.ts    # Утилиты для таймлайна
│       └── analytics.utils.ts   # Утилиты для аналитики
├── components/                   # Переиспользуемые компоненты
│   ├── PeriodFilter.tsx         # Фильтр периода
│   ├── TimelineModeSelector.tsx # Селектор режима
│   ├── CompanyStats.tsx         # Статистика компании
│   └── TimelineCell.tsx        # Ячейка таймлайна
├── features/                    # Основные фичи
│   └── TimelineTable.tsx        # Таблица таймлайна
├── DealsReportTimelineCompact.tsx # Главный компонент
├── example.tsx                  # Пример использования
├── index.ts                     # Экспорты модуля
├── README.md                    # Документация
└── ARCHITECTURE.md              # Архитектурная документация
```

## Принципы архитектуры

### 1. Разделение ответственности
- **Model** - типы данных и состояние (Redux)
- **Lib** - бизнес-логика и утилиты
- **Components** - переиспользуемые UI компоненты
- **Features** - сложная бизнес-логика с UI

### 2. Feature-Sliced Design
- Каждый слой имеет четкую ответственность
- Зависимости направлены от внешних слоев к внутренним
- Легко тестировать и поддерживать

### 3. Redux для состояния
- Централизованное управление состоянием
- Предсказуемые обновления
- Легкая интеграция с другими модулями

## Компоненты

### Model Layer

#### types/index.ts
Содержит все TypeScript типы и интерфейсы:
- `PeriodFilter` - фильтр периода
- `TimelineMode` - режимы отображения
- `CompanyStats` - статистика компании
- `YearlyData` - данные по годам
- `MonthlyPayment` - ежемесячные платежи

#### slice/timelineSlice.ts
Redux slice для управления состоянием таймлайна:
- `setPeriodFilter` - установка фильтра
- `setTimelineMode` - смена режима
- `toggleCompany` - переключение компаний
- `resetTimeline` - сброс состояния

### Lib Layer

#### timeline.utils.ts
Утилиты для работы с таймлайном:
- `calculateCompanyStats` - расчет статистики
- `calculateYearlyMatrix` - матрица по годам
- `calculateMonthlyPayments` - ежемесячные платежи
- `getDealColor` - цветовая индикация

#### analytics.utils.ts
Утилиты для аналитики:
- `calculateImplementationIndex` - индекс реализации
- `calculateMonthlyIndexData` - месячные данные
- `calculateHeatmapData` - данные тепловой карты

### Components Layer

#### PeriodFilter.tsx
Компонент фильтрации с поддержкой:
- Выбора периода (год от/до)
- Фильтрации по статусу клиентов
- Фильтрации по индексации

#### TimelineModeSelector.tsx
Переключатель режимов отображения:
- Детализация
- Средние показатели
- Итоговые показатели

#### CompanyStats.tsx
Отображение статистики компании:
- Текущий показатель
- Средний показатель
- Итого за период
- Индексация

#### TimelineCell.tsx
Ячейка таймлайна с поддержкой:
- Детального режима (матрица по годам)
- Режима средних показателей
- Режима итоговых показателей

### Features Layer

#### TimelineTable.tsx
Основная таблица таймлайна:
- Фильтрация компаний
- Отображение данных по режимам
- Интеграция всех компонентов

## Интеграция с приложением

### Изолированная фича
Timeline является полностью изолированной фичей и не зависит от основного модуля deals-report. Он использует локальное состояние React и может быть легко интегрирован в любое приложение.

### Использование в приложении
```typescript
import { DealsReportTimelineCompactRefactored } from './TimeLineTable';

// Использование нового компонента
<DealsReportTimelineCompactRefactored companies={companies} />
```

### Интеграция с Redux (опционально)
Если нужно интегрировать timeline с Redux store, можно подключить timelineReducer:

```typescript
// В store
import { timelineReducer } from './TimeLineTable';

const store = configureStore({
  reducer: {
    // другие редьюсеры
    timeline: timelineReducer,
  },
});
```

## Преимущества новой архитектуры

### 1. Модульность
- Каждый компонент имеет четкую ответственность
- Легко тестировать отдельные части
- Простое добавление новых функций

### 2. Переиспользование
- Компоненты можно использовать в других местах
- Утилиты доступны для других модулей
- Типы можно импортировать везде

### 3. Масштабируемость
- Легко добавлять новые фичи
- Простое расширение функциональности
- Гибкая архитектура

### 4. Поддерживаемость
- Четкая структура кода
- Легко найти нужный функционал
- Простое исправление багов

## Миграция

### Шаг 1: Использование нового компонента
Замените импорт старого компонента на новый:
```typescript
// Было
import { DealsReportTimelineCompact } from './DealsReportTimelineCompact';

// Стало
import { DealsReportTimelineCompactRefactored } from './TimeLineTable';
```

### Шаг 2: Обновление Redux store
Добавьте timeline reducer в основной slice (уже сделано).

### Шаг 3: Тестирование
Протестируйте все функции:
- Фильтрация по периоду
- Фильтрация по статусу клиентов
- Фильтрация по индексации
- Переключение режимов отображения
- Обработка пересекающихся сделок

## Дальнейшее развитие

### Возможные улучшения:
1. **Тестирование** - добавление unit и integration тестов
2. **Производительность** - мемоизация и оптимизация рендеринга
3. **Доступность** - улучшение a11y
4. **Интернационализация** - поддержка множественных языков
5. **Анимации** - плавные переходы между режимами
